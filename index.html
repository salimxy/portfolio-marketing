<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Portfolio Marketing</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>

  <script>
    // Initialize Netlify Identity
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }

    // Custom preview templates
    CMS.registerPreviewTemplate('projects', ({ entry, widgetFor, widgetsFor }) => {
      const data = entry.getIn(['data']).toJS();

      return h('div', { className: 'project-preview' },
        h('style', {}, `
          .project-preview {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          }
          .project-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1E293B;
            margin-bottom: 0.5rem;
          }
          .project-client {
            color: #0891B2;
            font-weight: 600;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
          }
          .project-section {
            margin-bottom: 1.5rem;
          }
          .project-section h4 {
            color: #1E293B;
            margin-bottom: 0.8rem;
            font-size: 1rem;
          }
          .project-section h4::before {
            content: '●';
            color: #F59E0B;
            margin-right: 0.5rem;
          }
          .project-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
          }
          .project-tag {
            background: #F8FAFC;
            color: #1E293B;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            border: 1px solid #e2e8f0;
          }
          ol {
            padding-left: 1.2rem;
          }
          li {
            margin-bottom: 0.5rem;
          }
        `),
        h('div', { className: 'project-title' }, data.title),
        h('div', { className: 'project-client' }, data.client_type),

        h('div', { className: 'project-section' },
          h('h4', {}, 'Objectif'),
          h('p', {}, data.objective?.description || '')
        ),

        h('div', { className: 'project-section' },
          h('h4', {}, 'Processus'),
          h('ol', {},
            (data.process?.steps || []).map(step =>
              h('li', { key: step }, step)
            )
          )
        ),

        h('div', { className: 'project-section' },
          h('h4', {}, 'Résultats'),
          h('p', {}, data.results?.description || '')
        ),

        h('div', { className: 'project-tags' },
          (data.tags || []).map(tag =>
            h('span', { key: tag, className: 'project-tag' }, tag)
          )
        )
      );
    });
  </script>
</body>
</html>